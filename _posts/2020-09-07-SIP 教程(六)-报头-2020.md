---
layout:     post
title:      "SIP 教程(六) 报头, 2020"
subtitle:   "SIP"
date:       2020-09-07 08:54:00
author:     "Ruer"
header-img: "img/bg/hello_world.jpg"
catalog: true
tags:
    - SIP
---

报头是传达关于消息信息的 SIP 消息的组件。它被构造为头字段序列。

SIP 头字段在大多数情况下遵循与 HTTP 头字段相同的规则。标题字段定义为 `Header:` 字段，其中 Header 用于表示标题字段名称，字段是包含信息的标记集合。每个字段包含一个字段名称，后跟冒号(“`:`")和字段值(即字`段名称:字段值`)。

许多常见的 SIP 报头字段具有紧凑形式，其中报头字段名称由单个小写字符表示。 一些例子如下：

| 报头           | 紧凑型 |
| :------------- | :---- |
| To             | T     |
| Via            | V     |
| Call-ID        | I     |
| Contact        | M     |
| From           | F     |
| Subject        | S     |
| Content-Length | I     |

## 报头格式

下图显示了典型 SIP 报头的结构:

![1](/img/SIP/报头结构.jpg)

根据其在 SIP 中的用法，报头被分类如下:

* 请求和响应
* 仅请求
* 仅响应
* 消息体

## 请求和响应

#### Accept

Accept 头字段用于在消息正文中指示可接受的消息的 Internet 媒体类型。

* 标题字段描述使用通常在因特网中使用的格式类型/子类型的媒体类型。
* 如果不存在，则假定可接受的消息体格式为 application / sdp 。
* 媒体类型列表可以使用 q 值参数设置首选项。

#### Accept-Encoding

Accept-Encoding 头字段用于指定可接受的消息体编码方案。

* 编码可以用于确保具有大消息体的 SIP 消息适合单个 UDP 数据报。
* 使用 q 值参数可以设置首选项。如果所列出的方案都不能被 UAC 接受，则返回 406 不可接受的响应。如果不包括，则假设的编码将是 text / plain 。

#### To

To 表示请求的最终收件人。UA 生成的任何响应将包含此标头字段并添加标签。它是必需的头。

* 代理生成的任何响应必须在 To 头字段中添加标签。
* To 头字段 URI 从不用于路由。

#### From

From 头字段表示请求的发起者。它是用于标识对话框的两个地址之一。

* A From 头字段可以包含用于标识特定呼叫的标签。
* 它可以包含显示名称，在这种情况下，URI 包含在 <>。
* 它是必需的头。

#### Call-ID

Call-ID 头字段在所有 SIP 请求和响应中是强制的。它用于唯一标识两个用户代理之间的呼叫。

* 呼叫 ID 在呼叫之间必须是唯一的。
* 用户代理的所有注册应使用相同的 Call-ID。
* Call-ID 始终由用户代理创建，并且不会被服务器修改。
* 它是一个加密随机标识符。

#### Via

Via 用于记录由有助于将响应路由回始发者的请求所采用的 SIP 路由。

* 生成请求的 UA 在 Via 头字段中记录其自己的地址。
* 转发请求的代理将 Via 头字段包含其自己的地址添加到 Via 头字段列表的顶部。
* 生成对请求的响应的代理或 UA 将请求中的所有 Via 报头字段按顺序复制到响应中，然后将响应发送到在顶部 Via 报头字段中指定的地址。
* 接收响应的代理检查顶部 Via 头字段并匹配其自身的地址。
* 如果不匹配，则响应已被丢弃。
* 然后删除顶部 Via 头字段，并将响应转发到在下一个 Via 头字段中指定的地址。
* Via 头字段包含协议名称，版本号和传输(SIP / 2.0 / UDP，SIP / 2.0 / TCP 等)，并且可以包含端口号和参数，例如接收的: rport、branch、maddr 和 ttl。
* 如果 UA 或代理从与在顶部 Via 头字段中指定的地址不同的地址接收到请求，则将收到的标签添加到 Via 头字段。
* 分支参数通过 UA 和代理被添加到 Via 报头字段，其被计算为 Request-URI 的哈希函数，以及 To、From、Call-ID 和 CSeq 数。

#### CSeq

CSeq 头字段是每个请求中所需的头字段。 它包含对每个请求增加的十进制数。

* 通常，对于每个新请求，除了 CANCEL 和 ACK 请求，它使用它所引用的 INVITE 请求的 CSeq 号，它增加1。
* UAS 使用 CSeq 计数来确定失序请求或区分新请求(不同 CSeq)或重传(相同 CSeq)。
* CSeq 头字段由 UAC 使用以匹配对其引用的请求的响应。
* 例如，发送 INVITE 请求然后发送 CANCEL 请求的 UAC 可以通过 CSeq 中的方法告知 200 OK 响应，如果它是对邀请或取消请求的响应。

#### Contact

Contact 头字段用于向其他用户传达关于请求发起者的地址。 一旦接收到联系人报头字段，URI 可以被缓存并且用于在对话中路由未来的请求。

例如，在对 INVITE 的 200 OK 响应中的联系人报头字段可以允许确认 ACK 消息和在该呼叫期间的所有未来请求绕过代理并直接去往被叫方。

#### Record-Route

Record-Route 头字段用于强制路由通过代理以用于两个 UA 之间的会话(对话)中的所有后续请求。

通常，Contact 头字段的存在允许 UA 直接绕过初始请求中使用的代理链来发送消息。

* 将其地址插入到`记录 - 路由`头部字段中的代理覆盖此并且迫使将来的请求包括包含强制该代理被包括的代理的地址的 Route 头字段。
* 希望实现此操作的代理将插入包含其自己的 URI 的头字段，或将其 URI 添加到已经存在的 Record-Route 头字段。
* 构造 URI 以便 URI 解析回代理服务器。UAS 将 Record-Route 头字段复制到对请求的 200 OK 响应中。
* 头字段由代理不变地转发回 UAC。然后，UAC 存储记录 - 路由代理列表加上联系人头字段(如果在 200 OK 中存在)，以便在所有后续请求中的路由头字段中使用。

#### Organization

组织头字段用于指示消息的发起者所属的组织。

* 它也可以由代理插入，因为消息从一个组织传递到另一个组织。
* 与所有 SIP 报头字段一样，它可以由代理用于做出路由决定，并且由 UA 用于进行呼叫筛选决定。

#### Retry-After

它用于指示资源或服务何时可以再次可用。

* 在503服务不可用响应中，它指示服务器何时可用。
* 在404未找到，600 Busy Everywhere 和603拒绝响应中，它指示被叫 UA 何时可以再次可用。
* 它包含以秒为单位的时间段。

#### Subject

可选的 Subject 头字段用于指示媒体会话的主题。

报头字段的内容也可以在提醒期间显示，以帮助用户决定是否接受呼叫。

```
Example:
Subject: How are you?
```

#### Supported

Supported 头字段用于列出 UA 或服务器实现的一个或多个选项。

* 它通常包含在对 OPTIONS 请求的响应中。
* 如果未实现任何选项，则不包括头字段。
* 如果 UAC 列出了支持报头字段中的选项，代理或 UAS 可以在呼叫期间使用该选项。
* 如果必须使用或支持该选项，那么将使用 Require 头字段。

```
Example:
Supported: rel100
```

#### Expires

Expires 头字段用于指示请求或消息内容有效的时间间隔。

* 当存在于 INVITE 请求中时，报头字段在 INVITE 请求的完成时设置时间限制。
* 也就是说，UAC 必须在该时间段内接收最终响应(非1xx)，或者 INVITE 请求被408请求超时响应自动取消。
* 一旦建立会话，来自原始 INVITE 中的 Expires 头字段的值没有效果。为此目的必须使用 Session-Expires 头字段。
* 如果存在于 REGISTER 请求中，则头字段在 Contact 头字段中的 URI 上设置不包含 expires 参数的时间限制。
* Expires 也用于 SUBSCRIBE 请求中，以指示订阅持续时间。

```
Example:
Expires: 30
```

#### User-Agent

该报头字段用于传送关于发起请求的 UA 的信息。

## 仅请求


## 仅响应


## 消息体