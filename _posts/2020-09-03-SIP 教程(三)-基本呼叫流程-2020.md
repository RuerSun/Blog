---
layout:     post
title:      "SIP 教程(三) 基本呼叫流程, 2020"
subtitle:   "SIP"
date:       2020-09-03 08:54:00
author:     "Ruer"
header-img: "img/bg/hello_world.jpg"
catalog: true
tags:
    - SIP
---

下图显示了SIP会话的基本呼叫流程。

![1](/img/SIP/基本呼叫流程.jpg)

下面给出了上述调用流程的逐步解释：

* 发送到代理服务器的 INVITE 请求负责启动会话。

* 代理服务器立即向呼叫者(Alice)发送 100 Trying 响应以停止 INVITE 请求的重传。

* 代理服务器在位置服务器中搜索 Bob 的地址。在获得地址之后，它进一步转发 INVITE 请求。

* 此后，由 Bob 产生的 180响铃(临时响应)被返回给 Alice。

* Bob 在接听电话后立即生成 200 OK 响应。

* Bob 收到 200 OK 时，Bob 会收到来自 Alice 的 ACK 。

* 同时，会话建立并且 RTP 分组(对话)开始从两端流动。

* 在对话之后，任何参与者(Alice 或 Bob)可以发送 BYE 请求以终止会话。

* BYE 直接从 Alice 到 Bob 绕过代理服务器。

* 最后，Bob 发送 200 OK 响应以确认 BYE 并且会话终止。

* 在上述基本呼叫流程中，三个事务(标记为1,2,3)可用。

完整的呼叫(从 INVITE 到200 OK)称为 Dialog 。

代理如何帮助将一个用户与另一个用户连接？

![2](/img/SIP/SIP梯形.jpg)

图中所示的拓扑称为SIP梯形。该过程如下进行：

* 当呼叫者发起呼叫时，向代理服务器发送 INVITE 消息。在接收到 INVITE 时，代理服务器尝试在 DNS 服务器的帮助下解析被调用者的地址。

* 在获得下一个路由之后，呼叫者的代理服务器(代理1，也称为出站代理服务器)将 INVITE 请求转发到被叫者的代理服务器，该代理服务器充当被叫者的入站代理服务器(代理2)。

* 入站代理服务器与位置服务器联系以获取有关用户注册的被叫方地址的信息。

* 在从位置服务器获取信息之后，它将呼叫转发到其目的地。

* 一旦用户代理知道他们的地址，他们可以绕过呼叫，即对话直接传递。