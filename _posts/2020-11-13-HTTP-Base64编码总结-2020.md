---
layout:     post
title:      "HTTP Base64编码总结, 2020"
subtitle:   "介绍"
date:       2020-11-12 08:54:00
author:     "Ruer"
header-img: "img/bg/hello_world.jpg"
catalog: true
tags:
    - HTTP
---

## 编码原因

* 使用HTTP协议传输二进制数据可能会出现无法预知的错误，参考有关使用HTTP协议传输二进制文件
* 很多场景下的数据传输要求数据只能由简单通用的字符组成，比如HTTP协议要求请求的首行和请求头都必须是ASCII编码
* 很多比较老的协议还是只支持纯文本的，比如SMTP协议
* 提升效率，用Data URL技术，允许使用Base64对图片或其他文件的二进制数据进行编码，将其作为文本字符串嵌入网页中，避免不必要的外部资源加载

## 如何编码

编码表：

![1](/img/HTTP/Base64编码表.jpg)

编码流程：

* 对应一个base 64 编码表
    * 包含大小写字母52个，0-9的数字10个，还有+和/两个符号
* 每3个原始字符编码成4个字符
    * 编码后的每个字符最高2位一定是0
    * 范围是[0, 63]
    * 如果字符数不是3的倍数，后面用零补齐
    * 末尾的0x00000000用=表示
* 编码后增加换行符
    * base64在RFC2045有规定：Base64一行不能超过76个字符，超过则添加回车换行符（windows平台下则为\n）

假设我们要对 Hello! 进行Base64编码，按照ASCII表，其转换过程如下图所示：

![2](/img/HTTP/Base64转换过程.jpg)

Hello!! Base64编码的结果为 SGVsbG8hIQAA 。最后2个零值只是为了Base64编码而补充的，在原始字符中并没有对应的字符，那么Base64编码结果中的最后两个字符 AA 实际不带有效信息，所以需要特殊处理，以免解码错误。

标准Base64编码通常用 = 字符来替换最后的 A，即编码结果为 SGVsbG8hIQ==。因为 = 字符并不在Base64编码索引表中，其意义在于结束符号，在Base64解码时遇到 = 时即可知道一个Base64编码字符串结束。

## 如何解码

* 去掉多余的=号
* 只需要按照编码表，逆向转成二进制数据
* 每个字符的二进制去掉最高的两位，最后拼接在一起，就是编码前的二进制数据流

## 总结

* base64将二进制字符转换成64个可见的文本字符，在某些场景下方便传输
* base64不是一种加密方法，操作的本质不是加密